{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Boomalgo</title>
  <style>
    /* General Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #89f7fe, #66a6ff); /* Dynamic background */
      color: #34495E;
      overflow-x: hidden;
      animation: gradientBackground 15s ease infinite;
      background-size: 400% 400%;
    }

    @keyframes gradientBackground {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    /* Navbar Styles */
    .navbar-custom {
      background: linear-gradient(90deg, #ff6b81, #ff9a9e);
      padding: 15px 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      position: fixed;
      width: calc(100% - 250px);
      top: 0;
      left: 250px;
      z-index: 1000;
      border-bottom: 3px solid #2c3e50;
    }

    .navbar-custom .navbar-brand,
    .navbar-custom .navbar-nav .nav-link {
      color: #ffffff;
      font-weight: bold;
      transition: color 0.3s ease;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .navbar-custom .navbar-nav .nav-link:hover {
      color: #ffe66d;
      background-color: rgba(255, 230, 109, 0.2);
      border-radius: 5px;
      transform: translateY(-2px);
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 250px;
      background: linear-gradient(135deg, #6dd5ed, #2193b0); /* Gradient sidebar */
      padding-top: 20px;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.2);
      z-index: 999;
      transition: all 0.5s ease;
      text-align: center;
    }

    .sidebar img {
      width: 120px;
      height: auto;
      margin-bottom: 20px;
      border-radius: 50%;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
    }

    .sidebar a {
      color: #ffffff;
      display: block;
      padding: 15px 20px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s, color 0.3s, transform 0.3s;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .sidebar a:before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0;
      background: rgba(255, 255, 255, 0.2);
      transition: width 0.3s;
      z-index: -1;
    }

    .sidebar a:hover:before {
      width: 100%;
    }

    .sidebar a:hover {
      color: #ffe66d;
      transform: translateX(10px);
    }

    .sidebar a.active {
      background-color: #34495E;
      color: #ffffff;
      box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.3);
    }

    .sidebar i {
      margin-right: 10px;
    }

    /* Content Styles */
    .content {
      margin-left: 250px;
      padding: 100px 30px 30px;
      animation: slideIn 1s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card-custom {
      background: linear-gradient(135deg, #ffe66d, #f6d365);
      color: #34495E;
      box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.15);
      border-radius: 15px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-custom:hover {
      transform: translateY(-10px);
      box-shadow: 0px 15px 45px rgba(0, 0, 0, 0.3);
    }

    .card-custom .card-header,
    .card-custom .card-footer {
      background: rgba(255, 255, 255, 0.7);
      border: none;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
    }

    .btn-custom-slider {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
      background: linear-gradient(90deg, #3bff14, #1e90ff);
      border-radius: 50px;
      transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
    }

    .btn-custom-slider::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 5px;
      width: 24px;
      height: 24px;
      background-color: #ffffff;
      border-radius: 50%;
      transform: translateY(-50%);
      transition: transform 0.3s ease-in-out;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .btn-custom-slider.active {
      background: linear-gradient(90deg, #ff6b81, #f7b42c);
    }

    .btn-custom-slider.active::before {
      transform: translate(30px, -50%);
    }

    .btn-custom-slider:hover {
      box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-custom-slider:active::before {
      width: 28px;
    }

    /* Notification and Profile Popup Styles */
    .popup {
      position: fixed;
      top: 60px;
      right: 20px;
      width: 320px;
      background-color: #ffffff;
      border: 1px solid #34495E;
      box-shadow: 0 0 20px rgba(52, 73, 94, 0.2);
      z-index: 1001;
      animation: slideIn 0.5s ease-out;
      display: none;
      border-radius: 15px;
      overflow: hidden;
    }

    .popup-header {
      padding: 15px;
      background-color: #34495E;
      color: #ffffff;
      font-weight: bold;
      text-align: center;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      font-size: 16px;
      text-transform: uppercase;
      position: relative;
    }

    .popup-header i {
      position: absolute;
      top: 50%;
      right: 15px;
      transform: translateY(-50%);
      cursor: pointer;
      color: #ff6b81;
      transition: color 0.3s ease;
    }

    .popup-header i:hover {
      color: #ffe66d;
    }

    .popup-body {
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
    }

    .popup-body p {
      margin: 0;
      padding: 10px;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.3s ease;
    }

    .popup-body p:hover {
      background-color: rgba(255, 230, 109, 0.2);
    }

    /* Profile Picture */
    .profile-popup .profile-picture {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto 15px;
      border: 4px solid #34495E;
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
    }

    .profile-popup .profile-picture img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* Profile Popup Specific Styles */
    .profile-popup .popup-body p {
      margin: 0;
      padding: 10px 0;
      font-size: 15px;
      line-height: 1.5;
      border-bottom: 1px solid #dcdcdc;
    }

    .profile-popup .popup-body p:last-child {
      border-bottom: none;
    }

    .profile-popup .popup-body a {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 20px;
      color: #ffffff;
      text-decoration: none;
      background-color: #ff6b81;
      border-radius: 5px;
      text-align: center;
      transition: background-color 0.3s ease, color 0.3s ease;
      font-weight: bold;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .profile-popup .popup-body a:hover {
      background-color: #34495E;
      color: #ffffff;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 992px) {
      .navbar-custom {
        left: 0;
        width: 100%;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        top: 60px;
        z-index: 998;
        display: none;
        background: linear-gradient(135deg, #6dd5ed, #2193b0);
      }

      .sidebar.active {
        display: block;
      }

      .content {
        margin-left: 0;
        padding-top: 120px;
      }

      .navbar-toggler-icon {
        color: #34495E;
      }
    }

    @media (max-width: 576px) {
      .popup {
        right: 10px;
        width: 95%;
      }

      .popup-header {
        font-size: 14px;
      }

      .popup-body {
        padding: 10px;
        font-size: 14px;
      }
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebarMenu">
    <img src="{% static 'your-logo.png' %}" alt="Logo">
    <a href="{% url 'client_dashbord' %}" class="{% if request.path == '/dashbord/' %} active {% endif %}">
      <i class="fa-solid fa-home"></i>
      Dashboard
    </a>
    <a href="{% url 'trade_list' %}" class="{% if request.path == '/trade_list/' %} active {% endif %}">
      <i class="fa-solid fa-signal"></i>
      Signals
    </a>
    <a href="{% url 'client_trade_history' %}" class="{% if request.path == '/client_trade_history/' %} active {% endif %}">
      <i class="fa-solid fa-history"></i>
      Trade History
    </a>
    <a href="{% url 'client_status' %}" class="{% if request.path == '/tradingstatus/' %} active {% endif %}">
      <i class="fa-solid fa-chart-line"></i>
      Status Update
    </a>
    <a href="{% url 'fetch_and_display_orders' %}" class="{% if request.path == '/fetch_and_display_orders/' %} active {% endif %}">
      <i class="fa-solid fa-first-order-alt"></i>
      Broker Response
    </a>
    <a href="{% url 'client_help_center' %}" class="{% if request.path == '/client_help_center/' %} active {% endif %}">
      <i class="fa-solid fa-headset"></i>
      Support
    </a>
    <a href="{% url 'homes' %}" class="{% if request.path == '/homes/' %} active {% endif %}">
      <i class="fa-solid fa-home"></i>
      Home
    </a>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>
    </button>
    <div class="btn-custom-slider ml-3" id="brokerConnectButton"></div>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#" id="notificationIcon"><i class="fa-solid fa-bell"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="profileIcon"><i class="fa-solid fa-user-circle"></i></a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="content">
    <div class="container-fluid">
      <div class="card card-custom">
        <div class="card-body">
          {% block main %}
          <!-- Main content goes here -->
          {% endblock %}
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Popup -->
  <div class="popup" id="notificationPopup">
    <div class="popup-header">
      Notifications
      <i class="fas fa-times" onclick="document.getElementById('notificationPopup').style.display='none'"></i>
    </div>
    <div class="popup-body" id="notificationBody">
      <p>No new notifications.</p>
    </div>
  </div>

  <!-- Profile Popup -->
  <div class="popup profile-popup" id="profilePopup">
    <div class="popup-header">
      Profile Details
      <i class="fas fa-times" onclick="document.getElementById('profilePopup').style.display='none'"></i>
    </div>
    <div class="popup-body">
      <div class="profile-picture">
        <img src="{% static 'pic.jpg' %}" alt="Profile Picture">
      </div>
      <p><strong>Name:</strong> {{ client_user.clint_name_first }} {{client_user.clint_name_last}}</p>
      <p><strong>Email:</strong> {{ client_user.clint_email }}</p>
      <p><strong>Mobile:</strong> {{ client_user.clint_phone_number }}</p>
      <p><strong>Broker:</strong> {{ client_user.broker }}</p>
      <p><strong>API Key:</strong> {{ client_user.api_key }}</p>
      <p><strong>Start Date:</strong> {{ client_user.clint_date_joined }}</p>
      <p><strong>Expire On:</strong> {{ client_user.clint_last_login }}</p>
      <a href="#">Change Password</a>
      <a href="{% url 'client_logout' %}">Logout</a>
    </div>
  </div>

  <!-- Include jQuery and Bootstrap JavaScript in the correct order -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+AiZK9Ll7/2hb7U6ka5c2e1uP4hL9F/l/71N1UnK27+q2MfRTO" crossorigin="anonymous"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const sliderButton = document.getElementById('brokerConnectButton');

        if (localStorage.getItem('apiConnect') === 'on') {
            sliderButton.classList.add('active');
        }

        sliderButton.addEventListener('click', function () {
            sliderButton.classList.toggle('active');
            if (sliderButton.classList.contains('active')) {
                localStorage.setItem('apiConnect', 'on');
                window.location.href = "{% url 'redirect_to_smartapi_login' %}";
            } else {
                localStorage.setItem('apiConnect', 'off');
                window.location.href = "{% url 'off' %}";
            }
        });

        window.addEventListener('storage', function () {
            if (localStorage.getItem('apiConnect') === 'on') {
                sliderButton.classList.add('active');
            } else {
                sliderButton.classList.remove('active');
            }
        });

        const notificationIcon = document.getElementById('notificationIcon');
        const notificationPopup = document.getElementById('notificationPopup');
        const notificationBody = document.getElementById('notificationBody');

        notificationIcon.addEventListener('click', function () {
            notificationPopup.style.display = notificationPopup.style.display === 'block' ? 'none' : 'block';
            if (notificationPopup.style.display === 'block') {
                fetchNotifications();
            }
        });

        function fetchNotifications() {
            fetch('/get-notifications/')
                .then(response => response.json())
                .then(data => {
                    notificationBody.innerHTML = '';
                    data.forEach(notification => {
                        const p = document.createElement('p');
                        p.textContent = `${notification.message} - ${new Date(notification.created_at).toLocaleString()}`;
                        notificationBody.appendChild(p);
                    });
                });
        }

        document.addEventListener('click', function (event) {
            if (!notificationIcon.contains(event.target) && !notificationPopup.contains(event.target)) {
                notificationPopup.style.display = 'none';
            }
        });

        const profileIcon = document.getElementById('profileIcon');
        const profilePopup = document.getElementById('profilePopup');

        profileIcon.addEventListener('click', function () {
            profilePopup.style.display = profilePopup.style.display === 'block' ? 'none' : 'block';
        });

        document.addEventListener('click', function (event) {
            if (!profileIcon.contains(event.target) && !profilePopup.contains(event.target)) {
                profilePopup.style.display = 'none';
            }
        });

        const sidebarMenu = document.getElementById('sidebarMenu');
        const navbarToggler = document.querySelector('.navbar-toggler');

        navbarToggler.addEventListener('click', function () {
            sidebarMenu.classList.toggle('active');
        });
    });
  </script>
</body>

</html>
